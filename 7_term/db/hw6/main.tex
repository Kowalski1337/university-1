\documentclass{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtext}
\usepackage{mathtools}
\usepackage[T1,T2A]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[margin=1cm]{geometry}
\usepackage{microtype}
\usepackage{enumitem}
\usepackage{bm}
\usepackage{cancel}
\usepackage{proof}
\usepackage{epigraph}
\usepackage{titlesec}
\usepackage[dvipsnames]{xcolor}
\usepackage{stmaryrd}
\usepackage{cellspace}
\usepackage{cmll}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{tikz}
\usepackage{caption}
\usepackage{wrapfig}
\usepackage{minted}
\usepackage{svg}

\usepackage[hidelinks]{hyperref}

\usepackage[russian]{babel}
\selectlanguage{russian}

\hypersetup{%
    colorlinks=true,
    linkcolor=blue
}

\DeclareMathOperator{\avg}{avg}

\newcommand{\Students}{\mathrm{Students}}
\newcommand{\Sq}{\mathrm{S1}}
\newcommand{\Sw}{\mathrm{S2}}
\newcommand{\StudentId}{\mathrm{StudentId}}
\newcommand{\StudentName}{\mathrm{StudentName}}
\newcommand{\Groups}{\mathrm{Groups}}
\newcommand{\GroupId}{\mathrm{GroupId}}
\newcommand{\GroupName}{\mathrm{GroupName}}
\newcommand{\Courses}{\mathrm{Courses}}
\newcommand{\CourseId}{\mathrm{CourseId}}
\newcommand{\CourseName}{\mathrm{CourseName}}
\newcommand{\Plan}{\mathrm{Plan}}
\newcommand{\Lecturers}{\mathrm{Lecturers}}
\newcommand{\LecturerId}{\mathrm{LecturerId}}
\newcommand{\LecturerName}{\mathrm{LecturerName}}
\newcommand{\Marks}{\mathrm{Marks}}
\newcommand{\Mark}{\mathrm{Mark}}
\newcommand{\select}{\mathtt{select}~}
\newcommand{\from}{~\mathtt{from}~}
\newcommand{\as}{~\mathtt{as}~}
\newcommand{\where}{~\mathtt{where}~}

\newcommand{\join}{\mathbin{\mathrlap{\ltimes}{\rtimes}}}

\pagenumbering{gobble}

\title{Домашнее задание №5}
\author{Артем Оганджанян, M3439}
\date{}

\begin{document}

\renewcommand{\count}{\operatorname{count}}

\maketitle

\subsection{\texorpdfstring{База данных}{DB}}

\begin{itemize}
    \item $\Students: \StudentId, \StudentName, \GroupId$
    \item $\Groups: \GroupId, \GroupName$
    \item $\Courses: \CourseId, \CourseName$
    \item $\Lecturers: \LecturerId, \LecturerName$
    \item $\Plan: \GroupId, \CourseId, \LecturerId$
    \item $\Marks: \StudentId, \CourseId, \Mark$
\end{itemize}

\subsection{\texorpdfstring{Запросы}{Queries}}

\setlist[enumerate]{label*=\arabic*.}
\begin{enumerate}
    \item Информация о студентах с заданной оценкой $m_0$ по предмету «Базы данных».
    \begin{align*}
        &\Students \where \exists M (\exists C\\
        &(\StudentId = M.\StudentId \\
            &\land M.\Mark = m_0 \\
            &\land M.\CourseId = C.\CourseId \\
            &\land C.\CourseName = \text{`Базы данных'}))
    \end{align*}
    \begin{minted}{sql}
select * from
    Students natural join
    (select StudentId from
        (select CourseId from Courses where CourseName = 'Базы данных') as C
        natural join Marks
      where
        Mark=M0
    ) as S;
    \end{minted}
    \item Информация о студентах, не имеющих оценки по предмету «Базы данных».
    \begin{enumerate}
        \item Среди всех студентов.
        \[
            \Students \where \forall M (\neg \exists C
            (M.\StudentId = \StudentId
                \land M.\CourseId = C.\CourseId
                \land C.\CourseName = \text{`Базы данных'}))
        \]
    \begin{minted}{sql}
select * from Students except all select * from (
    Students natural join
    (select StudentId from
        (select CourseId from Courses where CourseName = 'Базы данных') as C
        natural join Marks
    ) as S
);
    \end{minted}
        \item Среди студентов, у которых есть этот предмет.
        \begin{align*}
            &\Students \where \\
            &\exists C (C.\CourseName = \text{`Базы данных'} \\
            &\land \exists P (P.\GroupId = \GroupId
                \land P.\CourseId = C.\CourseId) \\
            &\land \forall M
                (M.\StudentId <> \StudentId \lor M.\CourseId <> C.\CourseId)
            )
        \end{align*}
    \begin{minted}{sql}
select StudentId, StudentName, GroupId from
    Students natural join Plan natural join Courses
  where
    CourseName='Базы данных'
except all select * from (
    Students natural join
    (select StudentId from
        (select CourseId from Courses where CourseName = 'Базы данных') as C
        natural join Marks
    ) as S
);
    \end{minted}
    \end{enumerate}
    \item Информация о студентах, имеющих хотя бы одну оценку у заданного
        лектора с $\LecturerId=l_0$.
    \begin{align*}
        &\Students \where \\
        & \exists P (\exists M ( \\
        &\mathbin{\phantom{\land}} M.\StudentId = \StudentId \\
        &\land P.\LecturerId = l_0 \\
        &\land P.\CourseId = M.\CourseId))
    \end{align*}
    \begin{minted}{sql}
select StudentId, StudentName, GroupId from
    Students natural join Plan natural join Marks
  where
    LecturerId=L0;
    \end{minted}
    \item Идентификаторы студентов, не имеющих ни одной оценки у заданного
        лектора с $\LecturerId=l_0$.
    \begin{align*}
        &\select \StudentId \from \Students \where \\
        & \forall P (\forall M ( \\
        &\mathbin{\phantom{\lor}} M.\StudentId <> \StudentId \\
        &\lor P.\LecturerId <> l_0 \\
        &\lor P.\CourseId <> M.\CourseId))
    \end{align*}
    \begin{minted}{sql}
select StudentId from Students
except all select StudentId from
    Plan natural join Marks
  where
    LecturerId=L0;
    \end{minted}
    \item Студентов, имеющих оценки по всем предметам заданного
        лектора с $\LecturerId=l_0$.
    \begin{align*}
        &\Students \where \\
        & \forall P (P.\LecturerId <> l_0 \lor \\
        &(\exists M (M.\StudentId = \StudentId
        \land M.\CourseId = P.\CourseId)))
    \end{align*}
    \item Для каждого студента имя и предметы, которые он должен посещать.
    \begin{align*}
        &\select \Students.\StudentName, \Courses.\CourseName \\
        &\from \Students, \Courses, \Plan \\
        &\where \Students.\GroupId = \Plan.\GroupId
            \land \Courses.\CourseId = \Plan.\CourseId
    \end{align*}
    \begin{minted}{sql}
select StudentName, CourseName from
    Students natural join Plan natural join Courses;
    \end{minted}
    \item По лектору с $\LecturerId=l_0$ всех студентов,
        у которых он хоть что-нибудь преподавал.
    \[
        \Students \where \exists P (P.\LecturerId = l_0
        \land P.\GroupId = \GroupId)
    \]
    \begin{minted}{sql}
select StudentId, StudentName, GroupId from
    Students natural join Plan
  where LecturerId=L0;
    \end{minted}
    \item Такие пары студентов,
        что все сданные первым студентом предметы сдал и второй студент.
    \begin{align*}
        &\Sq \dblcolon \Students; \\
        &\Sw \dblcolon \Students; \\
        &\select \Sq.\StudentId \as \mathrm{StudentId1},
                 \Sq.\StudentName \as \mathrm{StudentName1}, \\
        &\phantom{\select} \Sw.\StudentId \as \mathrm{StudentId2},
                           \Sw.\StudentName \as \mathrm{StudentName2} \\
        &\from \Sq, \Sw \\
        &\where \forall M_1 (M_1.\StudentId <> \Sq.\StudentId
            \lor \exists M_2 (M_2.\StudentId = \Sw.\StudentId
            \land M_1.\CourseId = M_2.\CourseId))
    \end{align*}
    \item Такие группы и предметы, что все студенты группы сдали предмет.
    \[
        \Groups, \Courses \where
        \forall S (S.\GroupId <> \GroupId
        \lor \exists M (M.\StudentId = S.\StudentId
        \land M.\CourseId = \CourseId))
    \]
\end{enumerate}

\end{document}
